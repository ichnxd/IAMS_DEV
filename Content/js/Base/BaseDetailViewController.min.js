define(["baseView","app"],function(n,t){"use strict";function i(){}return i.TBTN_NEW=-1,i.TBTN_SAVE=-2,i.TBTN_SAVEANDCLOSE=-5,i.TBTN_REFRESH=-3,i.TBTN_DELETE=-4,i.prototype=Object.create(n.prototype),i.prototype.Init=function(r,u,f,e,o,s,h){var c,v,a,l,y,h;n.prototype.Init.call(this,r);c=this;c.ViewAccess=h;c.$ViewOptions=s;c._DeletedItems={};c.detailClipboard={};c.$dateFields=[];c.DisplayName!==undefined&&c.DisplayName!==null&&(c.ModelName=c.DisplayName);c.getRandomInt=function(){var n=1e3;return Math.floor(Math.random()*(1e4-n))+n};c.DetailViewForms=[];c.$onCheckBoxInitialized=function(n,t,i){i.element.on("click",function(i){c.$isReloadCurrentObject=!1;c.IsDeveloperMode===!0&&i.ctrlKey===!0&&(i.stopPropagation(),c.EditModelDetail_Setting(n,t))})};c.onRemoveImage=function(n){r.CurrentObject[n.PropertyName]=null};c.onFormUploaderInitialized=function(n){c.$timeout(function(){(c.$fileUploaders===undefined||c.$fileUploaders===null)&&(c.$fileUploaders=[]);c.$fileUploaders.push(n.component)},500)};c.customizeItem=function(n){n.editorOptions!==undefined&&n.editorOptions.type==="date"&&((c.$dateFields===undefined||c.$dateFields===null)&&(c.$dateFields=[]),c.$dateFields.push(n.dataField));n.itemType==="group"&&n.IsShowLabel===!1&&n.label===undefined&&(n.label={alignment:"right",text:n.caption,visible:!1})};c.onTab_Click=function(n){c.IsDeveloperMode===!0&&n.itemData.ID_Tab!==undefined&&n.jQueryEvent.ctrlKey===!0&&c.EditOnSQLView(2,c.ID_ModelObject,n.itemData.ID_Tab)};c.onTabInitialized=function(n){var t=n.component.option("items"),i=Enumerable.From(t).Where("$.title === 'General'").ToArray();i.length>0&&(c.$MainTab=n.component);c.$timeout(function(){var i=$(n.component._$wrapper).find(".dx-multiview-item");$.each(i,function(n,i){$(i).addClass("tab_"+t[n].title.replace(" ",""))})},500);c.$OtherTabs===undefined&&(c.$OtherTabs=[]);c.$OtherTabs.push(n.component)};r.ShowListView=function(){c.ListViewTab&&c.openModelListView(c.ListViewTab.ID_Tab,c.ListViewTab.ID_View)};c.$scope=r;c.$scope.PanelHeight=$(window).height()*.66+"px";c.$scope.FormContextMenuItems=[];c.$scope.CurrentObject=u;c.$scope.DataInformationText="";c.$FilesToUpload=null;c.ViewStateName=f;c.IsModal=e;c.ModalMode=o;c.SaveUrl="/JsApp/Save";c.ReloadUrl="/JsApp/GetCurrentObject";c.PropertyGridEditors=[];c.ValidationRules=[];c.$scope.StatusText="";c.$scope.PerformSave=function(){c.PerformSave()};c.$scope.PerformSaveAndClose=function(){c.CloseAfterSave=!0;c.PerformSave()};c.$scope.IsModelNotifShow=!1;c.$scope.ModelNotifOption={title:"Notification",onInitialized:function(n,t){c.ModelNotif=n;$(t).find(".counter").css({top:"-30px",right:"-12px"})}};c.$scope.MainScrollViewOption={height:c.IsModal===!0?o.IsFullScreen===!0?"83.3%":"80%":"83.3%",showScrollbar:"always",scrollByContent:!1,onInitialized:function(){}};c.$IsSaving=!1;c.$scope.OnElementInit=function(n){c.OnElementInit!==undefined&&c.OnElementInit(n)};c.$scope.onFileDelete=function(n,t,i){n.stopPropagation();n.preventDefault();c.ConfirmBox("Do you want to remove Attachment("+t+")").then(function(){var n,r;i!==undefined&&i!==null?c.JSDataService.Post("JsApp/DeleteFileAttachments",{ID_FileAttachment_Detail:i}).then(function(){c.Reload()}):(c.$scope.CurrentObject[t]=null,n=Enumerable.From(c.$FilesToUpload).Where("$.propertyName =='"+t+"'").SingleOrDefault(),n!==null&&n!==undefined&&(r=Enumerable.From(c.$FilesToUpload).IndexOf(n),r>-1&&c.$FilesToUpload.splice(r,1)))})};v=!1;c.$scope.onScrollViewInitialized=function(n){if(v===!1){$(n.element).on("dxmousewheel",function(n){$(n.target).hasClass("dx-scrollable-container")===!1&&n.preventDefault()});c.$timeout(function(){var u=$("#"+n.component.option("ID_Form")),t,r,f;i.PanelHeight===undefined&&(t=0,r=null,c.IsModal===!0?(r=u.find(".JsModalbtnContainer"),t=u.height()-$(r).height()-108):(r=u.find(".status-bar-container"),t=u.height()-$(r).height()-101),i.PanelHeight=t<50?undefined:t);f=i.PanelHeight;n.component.option("height",f)},500)}};c.addColumnClass=function(n,t,i,r){n.addClass(r)};c.addColumnClassMapping=function(n,t,i,r,u){var f,e;n.addClass(r);f=i[t];(f!==undefined||f!==null)&&(e=Enumerable.From(u).Where("$.ID ==="+f).SingleOrDefault().Value,e||n.addClass(e))};c.onControl_Initialized=function(n,t){c["set"+n+"Enabled"]=function(n){t.component.option("disabled",!n)};c["set"+n+"ReadOnly"]=function(n){t.component.option("readOnly",n)};c._onControl_Initialized!==undefined&&c._onControl_Initialized(n,t);t.component.NAME==="jDxImage"&&((c.$imgControls===undefined||c.$imgControls===null)&&(c.$imgControls=[]),c.$timeout(function(){c.$imgControls.push(t.component)},500))};c.AddGridActionButton=function(n,t){var i=c.GetGridOption(n).columns;i.unshift({dataField:"$ActionButtons",caption:"",fixed:!0,allowResizing:!0,width:30,allowEditing:!1,cellTemplate:function(n,i){n.addClass("GridActionButton");$("<div><\/div>").dxButton({text:t.icon===undefined?t.caption:undefined,icon:t.icon,hint:t.caption,disabled:c.IsFormReadOnly===!0,onClick:function(){if(c.IsFormReadOnly!==!0&&t.onClick!==undefined)t.onClick(i)}}).appendTo(n)}})};c.GetGridOption=function(n){return c.$scope[n+"GridOption"]};c.AddToolbarButton=function(n){c.$scope.FormContextMenuItems.push(n)};c.EditDetailViewControl=function(n){this.JsPopUpView.OpenDetailView(13,{ID_CurrentObject:n,fullScreen:!0})};c.EditListViewControl=function(n){this.JsPopUpView.OpenDetailView(14,{ID_CurrentObject:n,fullScreen:!0})};c.EditModelObject=function(n){this.JsPopUpView.OpenDetailView(4,{ID_CurrentObject:n,fullScreen:!0})};c.ShowGridColumnChooser=function(n){var t=c.GetGridEditor(n);t.showColumnChooser()};c.AddNewDetail=function(t,i,r){var u=this,f,e,o;if(r!==undefined&&r!==null){if(f=u.GetGridEditor(t),e=u.GetGridEditor(r),e.getSelectedRowsData().length===0)return;if(o=e.getSelectedRowsData()[0],o===null)return}u.JSDataService.GetCurrentObject("/JsApp/GetModelView",{ID:i,ID_ViewType:2,ViewName:null}).then(function(e){u.JSDataService.GetCurrentObject("/JsApp/GetCurrentObject",{ID:e.ID,ViewName:e.Name,ID_CurrentObject:-1}).then(function(e){u.OpenOnNewWindow(i,e).then(function(i){var s,o,e;if((i.$tempID===undefined||i.$tempID===null)&&(i.$tempID=n.$NewID()),r===null)u.$scope.CurrentObject[t]===null&&(u.$scope.CurrentObject[t]=[]),u.$scope.CurrentObject[t].push(i);else{if(s=u.GetGridEditor(r),s.getSelectedRowsData().length===0)return;o=s.getSelectedRowsData()[0];o!==null&&(e=null,e=o.ID>-1?Enumerable.From(u.$scope.CurrentObject[r]).Where("$.ID =="+o.ID).SingleOrDefault():Enumerable.From(u.$scope.CurrentObject[r]).Where("$.$tempID =="+o.$tempID).SingleOrDefault(),e[t]===null&&(e[t]=[]),e[t].push(i),f.option("dataSource",e[t]),f.refresh())}})})})};c.GetGridEditor=function(n){return Enumerable.From(c.PropertyGridEditors).Where(function(t){return t.PropertyName==n}).FirstOrDefault()};a=function(n){$.each(n,function(n,t){t.IsDisabled!==undefined&&(t.disabled=t.IsDisabled());t.items!==undefined&&a(t.items)})};c.RefreshToolBar=function(){var n=c.MainToolbar.option("dataSource");$.each(n,function(n,t){t.IsDisabled!==undefined&&(t.disabled=t.IsDisabled(c.$scope.CurrentObject));typeof t.gettext=="function"&&(t.text=t.gettext());typeof t.geticon=="function"&&(t.icon=t.geticon())});c.MainToolbar.repaint();c.ChildToolbars!==undefined&&$.each(c.ChildToolbars,function(n,t){var i=t.option("dataSource");i!=undefined&&($.each(i,function(n,t){t.IsDisabled!==undefined&&(t.disabled=t.IsDisabled(c.$scope.CurrentObject));t.items!==undefined&&a(t.items)}),t.repaint())})};c.GetDxControl=function(n){if(c.FormInstance==undefined)return null;var t=c.FormInstance.getEditor(n);if(t!==null&&t!==undefined)return t;$.each(c.DetailViewForms,function(i,r){return t=r.getEditor(n),t!==null&&t!==undefined?t:void 0})};l=function(n,t){var i=null;return $.each(t,function(t,r){if(r!==undefined&&i==null)if(r.items!==undefined)i===null&&(i=l(n,r.items));else if(r.dataField===n)return i=r}),i};c.BatchEditView=function(n,i){var r=c.GetGridEditor(n);t.$modal().Show({title:"Edit "+i,ViewSrc:"Templates/BatchEditGrid.html",width:$(window).width()*.8,height:$(window).height()*.8,InitController:function(n){var t=c.GetGridTabOption(r.PropertyName).GridOption;n.GridOption={columns:t.columns,dataSource:r.option("dataSource"),selection:{mode:"single",showCheckBoxesMode:"always"},rowAlternationEnabled:!0,allowColumnReordering:!0,showBorders:!1,height:function(){return"100%"},editing:c.IsFormReadOnly!==!0?{mode:"cell",allowUpdating:!0,allowAdding:!0,allowDeleting:!1,errorRowEnabled:!0,texts:{confirmDeleteMessage:""}}:undefined,loadPanel:{enabled:!1},scrolling:{mode:"virtual",scrollByThumb:!0},onRowUpdated:r.option("onRowUpdated")}}})};c.GetFormItem=function(n){var r=c.$scope.GeneralFormOptions.items[0].tabs,t=l(n,r),i;return t==null&&c.$scope.GeneralGridTabPabelItems!==undefined&&(i=Enumerable.From(c.$scope.GeneralGridTabPabelItems).Where("$.isForm == true").ToArray(),$.each(i,function(i,r){return t=l(n,r.formOption.items),t!==null&&(t.items!==undefined&&(t=l(n,t.items)),t!==null&&t.editorType!==undefined&&n==t.dataField)?!1:void 0})),t};c.GetFormItemOptions=function(n){var t=c.GetFormItem(n);return t==null?null:t.editorOptions};c.GetGridTabOption=function(n){if(c.$scope.GeneralGridTabPabelItems===undefined||c.$scope.GeneralGridTabPabelItems===null)return null;var t=Enumerable.From(c.$scope.GeneralGridTabPabelItems).Where(function(t){return t.PropertyName===n}).FirstOrDefault();if(t===undefined&&$.each(c.$scope.GeneralGridTabPabelItems,function(i,r){t===undefined&&r.ChildGrids!==undefined&&r.ChildGrids.length!==0&&(t=Enumerable.From(r.ChildGrids).Where(function(t){return t.PropertyName===n}).FirstOrDefault())}),t===null||t===undefined)throw new Error("cannot find property grid ("+n+")");return t};c.AddGridColumnValidationRule=function(n,t,i){var f=Enumerable.From(c.PropertyGridEditors).Where("$.PropertyName == '"+n+"'").SingleOrDefault(),r=f.columnOption(t),u;if(r.validationRules===undefined)r.validationRules=[];else if(u=Enumerable.From(r.validationRules).Where("$.id === "+i.id).SingleOrDefault(),u!==undefined&&u!==null)return;Array.isArray(i)?r.validationRules.concat(i):r.validationRules.push(i);f.columnOption(t,"validationRules",r.validationRules)};c.AddToolBarButtonOnGrid=function(n,t,i){c.$scope[n+"_MenuOptions"]==undefined&&(c.$scope[n+"_MenuOptions"]=[]);i===undefined?c.$scope[n+"_MenuOptions"].push(t):i==!0?c.$scope[n+"_MenuOptions"].unshift(t):c.$scope[n+"_MenuOptions"].push(t)};c.AddButtonReport=function(n){var t=Enumerable.From(c.$scope.FormContextMenuItems).Where("$.ID == -10099").SingleOrDefault();(t==undefined||t==null)&&(t={ID:-10099,text:"Reports",icon:"mdi mdi-file-hidden",color:"#3c763d",disabled:!1,isContextMenu:!0,items:[]},c.$scope.FormContextMenuItems.push(t));t.items.push({text:n.Name,reportData:n,icon:"mdi mdi-file-hidden",IsDisabled:n.IsDisabled,onItemClick:function(){var i=this.reportData,t=c.$scope.CurrentObject;if(t.ID==-1){c.MsgBox(c.DisplayName+" must be save first.");return}(n.isValid===undefined||n.isValid(t)!==!1)&&c.ViewReport(t.ID,i.ID_Report,t.Name,{ID:t.ID})}})};c.RefreshGridSelection=function(n,t){n.deselectAll();c.$timeout(function(){n.selectRowsByIndexes([t])},500)};c.DeleteAllItems=function(n){var t=c.GetGridEditor(n),u,i,r;if(t===undefined||t===null)throw new Error(n+" not found");u=t.ParentPropertyName;i=c.$scope.CurrentObject[n];c._DeletedItems[t._options.propertyName]===undefined&&(c._DeletedItems[t._options.propertyName]=[]);r=c.$scope.CurrentObject[t._options.propertyName];$.each(i,function(n,i){var u=r.indexOf(i);i.ID>0&&c._DeletedItems[t._options.propertyName].push(i);c.$timeout(function(){c.$scope.CurrentObject[t._options.propertyName].splice(u,1);c.OnDetailGrid_RowDeleted!==undefined&&c.OnDetailGrid_RowDeleted(t)})});t.refresh();c.$scope.CurrentObject.$dirty=!0};c.GetDetailGridOption=function(n,t,i,r,u,f,e,o,s,h,l,a,v,y,p,w,b){return{bindingOptions:{dataSource:t},propertyName:i,columns:r,columnResizingMode:"widget",height:function(){return o!==null?o:"auto"},columnAutoWidth:!0,filterRow:{visible:!1},groupPanel:{visible:!1},loadPanel:{enabled:!1},noDataText:"No Data",allowColumnResizing:!0,showRowLines:!0,remoteOperations:{summary:!0},scrolling:{useNative:!0},paging:{enabled:!0,pageSize:b},customizeColumns:function(n){$.each(n,function(n,t){t.dataType==="date"&&t.format!==null&&t.format!==undefined&&(t.cellTemplate=function(n,i){var r=i.data[t.dataField];r?n.html(Globalize.format(new Date(r),t.format)):n.html("")})});var t=Enumerable.From(n).Where('$.dataField == "ID"').SingleOrDefault();t!==undefined&&(t.caption="",t.width=50,t.allowHiding=!1,t.allowGrouping=!1,t.allowReordering=!1,t.allowResizing=!1,t.allowHiding=!1)},allowSorting:!1,onCellClick:function(n){if(n.rowType===undefined&&n.column===undefined){n.component.closeEditCell();return}if(n.column===undefined||n.column.command===undefined||n.column.command!=="expand"&&n.column.command!=="select"){if(c.IsFormReadOnly===!0&&n.column!==undefined){n.jQueryEvent.stopPropagation();n.component.clearSelection();n.component.selectRowsByIndexes([n.rowIndex]);return}if(n.column!==undefined&&n.column.dataField==="ID"){n.jQueryEvent.stopPropagation();n.component.clearSelection();n.component.selectRowsByIndexes([n.rowIndex]);return}if(n.jQueryEvent.stopPropagation(),n.data!==undefined){if(c.ModelHelper!==undefined&&n.column!==undefined&&c.ModelHelper.isColumnGridEditable(i,n)===!1)return;if(c.ViewHelper!==undefined&&n.column!==undefined&&c.ViewHelper.isColumnGridEditable(i,n)===!1)return}if(n.isEditing==!1&&n.component.closeEditCell(),c.IsFormReadOnly!==!0&&n.isEditing===!1){var t=n.component.getCellElement(n.rowIndex,n.columnIndex);t!==undefined&&(t.hasClass("JsCellFocus")?n.column.allowEditing==!0&&n.component.editCell(n.rowIndex,n.columnIndex):(n.element.find("td").removeClass("JsCellFocus"),t.addClass("JsCellFocus"),n.component.focus(t)))}}},focusStateEnabled:!0,onKeyDown:function(n){var t=n.jQueryEvent.keyCode,e,r,u,f;if(t===83&&n.jQueryEvent.ctrlKey===!0){n.jQueryEvent.preventDefault();return}if(t==27)e=n.component,e.clearSelection(),n.element.find("td").removeClass("JsCellFocus");else if(t!=8)if(t==46)r=n.component.getSelectedRowsData(),r.length>0&&c.DeleteDetails(n.component,r,h);else if(t==13){if(c.HasdxListViewEditor_Open==!0){n.jQueryEvent.stopPropagation();n.jQueryEvent.preventDefault();return}if(c.IsDeveloperMode===!0){if(n.jQueryEvent.ctrlKey==!0&&n.jQueryEvent.shiftKey==!0&&n.jQueryEvent.altKey==!0){p!==null&&c.JsPopUpView.OpenDetailView(15,{ID_CurrentObject:p});return}n.jQueryEvent.ctrlKey==!0&&n.jQueryEvent.shiftKey==!0&&c.EditModelDetail_Setting(y,i)}}else c.$isReloadCurrentObject=!1,c.OnKeyDown(n.jQueryEvent);if(n.jQueryEvent.ctrlKey===!0)if(t===67)u=n.component.getSelectedRowKeys(),u.length===1&&(f=angular.copy(u[0]),f.ID=-1,c.detailClipboard[i]=f,c.MsgBox("Copy to clipboard successfull"));else if(t===86&&c.detailClipboard[i]!==null&&c.detailClipboard[i]!==undefined&&c.onDetailPasteClipboard!==undefined)c.onDetailPasteClipboard(i,c.detailClipboard[i])},selection:{mode:"multiple",showCheckBoxesMode:"always"},rowAlternationEnabled:!0,allowColumnReordering:!0,showBorders:!1,editing:{mode:"cell",allowUpdating:!0,allowAdding:!0,allowDeleting:!1,errorRowEnabled:!0,texts:{confirmDeleteMessage:""}},sorting:{mode:"none"},columnChooser:{height:400,width:250},onContentReady:function(n){var t=null,r=null,f,e,u;h!==null&&h!==undefined?(f=c.GetGridEditor(h).getSelectedRowsData(),f.length>0&&(e=c.$scope.CurrentObject[h].indexOf(f[0]),r=c.$scope.CurrentObject[h][0],t=r[i])):t=c.$scope.CurrentObject[i];t!==undefined&&t!==null&&(c["$"+i+"_RowCount"]!==t.length&&(u=[],c.$timeout(function(){$.each(t,function(n,t){(t.ID==-1||t.ID==undefined||t.ID==null)&&(t.ID=c.getRandomInt()*-1,r!==null&&(t.$ID_Parent=r.ID),u.push(t))});u.length>0&&(c.$scope.CurrentObject.$dirty=!0);c["on"+i+"_RowInserted"]!==undefined&&c.$timeout(function(){c["on"+i+"_RowInserted"](n.component,u)})}),t.length!==c["$"+i+"_RowCount"]&&c["on"+i+"_RowUpdated"]!==undefined&&c.$timeout(function(){c["on"+i+"_RowUpdated"](n.component,t)}),n.component.refresh()),n.component.needSummaryUpdate===!0&&(n.component.needSummaryUpdate=!1,n.component.refresh()),c["$"+i+"_RowCount"]=t.length);c.ComputeExpression!==undefined&&c.$timeout(function(){c.ComputeExpression()})},onInitialized:function(n){n.element.on("mousewheel",function(n){n.altKey===!0&&n.stopPropagation()});c.IsDeveloperMode==!0&&($(n.element).attr("tabindex",-1e3),$(n.element).keydown(function(n){if(n.which===13){if(n.ctrlKey==!0&&n.shiftKey==!0&&n.altKey==!0){p!==null&&c.JsPopUpView.OpenDetailView(15,{ID_CurrentObject:p});return}n.ctrlKey==!0&&n.shiftKey==!0&&c.EditModelDetail_Setting(y,i)}}));n.component.PropertyName=i;n.component.ParentPropertyName=h;n.component.Caption=l;c.PropertyGridEditors.push(n.component);c["$"+i+"_RowCount"]=0;c["set"+i+"GridEnabled"]=function(t){n.component.option("editing.allowUpdating",t);t==!1?n.component._$element.find(".dx-datagrid").addClass("disabled-edit"):n.component._$element.find(".dx-datagrid").removeClass("disabled-edit")};c.$timeout(function(){c.$scope.CurrentObject[i]==null&&(c.$scope.CurrentObject[i]=[]);c.IsFormReadOnly!==undefined&&c.IsFormReadOnly===!0&&n.component.option("editing.allowUpdating",!1);h!==null&&n.component.option("dataSource",[]);(c.$scope.CurrentObject[i]==null||c.$scope.CurrentObject[i]==undefined)&&(c.$scope.CurrentObject[i]=[]);c["onGridInitialized_"+i]!==undefined&&c["onGridInitialized_"+i](n.component)},500);c.ComputeExpression!==undefined&&c.ComputeExpression()},onInitNewRow:function(){},onRowValidating:function(n){n.brokenRules.length&&(n.isValid=!0)},onEditingStart:function(){},onEditorPreparing:function(n){if(n.parentType==="dataRow"){if(n.row===undefined)return;var t=n.editorOptions.onValueChanged;n.editorOptions.onValueChanged=function(){c.$isReloadCurrentObject=!1;n.component.needSummaryUpdate=!0;n.component.lastRowColumnEdit={rowIndex:n.row.rowIndex,dataField:n.dataField,visibleIndex:n.visibleIndex};t.apply(this,arguments)}}},onRowUpdated:function(n){var t=null;c.$scope.CurrentObject[i]!==null&&c.$scope.CurrentObject[i]!==undefined&&(t=c.$scope.CurrentObject[i].indexOf(n.key));n.key.$dirty=!0;c.$scope.CurrentObject.$dirty=!0;c[i+"_onColumnChanged"]!==undefined&&c[i+"_onColumnChanged"].call(this,{data:n.data,dataField:Object.keys(n.data)[0],key:n.key,grid:n.component,rowIndex:t});c.ComputeExpression!==undefined&&c.ComputeExpression()},onSelectionChanged:function(n){var r=this,t;(n.element.find("td").removeClass("JsCellFocus"),(n.selectedRowKeys.length==0||n.selectedRowKeys.length>1)&&c.$timeout(function(){e!==null&&$.each(e,function(n,t){if(i!==t.PropertyName){var r=c.GetGridEditor(t.PropertyName);r.option("dataSource",null);c.$scope["$"+i+"RecordCount"]=""}});return}),n.selectedRowsData.length===1)&&(t=n.selectedRowKeys[0],e!==null&&$.each(e,function(n,r){i!=r.PropertyName&&c.$timeout(function(){var u=c.GetGridEditor(r.PropertyName),n;t!=undefined&&(n=t[r.PropertyName],n===undefined&&(n=[]),n===null&&(n=[]),u.option("dataSource",n),c.$scope["$"+i+"RecordCount"]=n.length)})}))},onContextMenuPreparing:function(t){var r,e,u;if(t.items==null&&(t.items=[]),t.jQueryEvent=window.event!==undefined?window.event:{},t.items.push({text:"Export to xls",icon:"fa fa-file-excel-o",onItemClick:function(){var n=c.GetGridEditor(i);n.exportToExcel(!1)}}),c.IsDeveloperMode&&t.jQueryEvent.ctrlKey==!0){t.items=[];t.items.push(c.GetDeveloperMenuOptions({name:n,ID_ModelListView:a,ID_PropertyModel:v,PropertyName:i}));t.items.push({text:"Column Chooser",color:"#008bba",align:"right",icon:"jspp-icon js-list",isSystem:!0,onItemClick:function(){c.ShowGridColumnChooser(i)}});t.items.push({text:"Edit Column ("+t.column.caption+")",icon:"mdi mdi-table-column-width",onItemClick:function(){c.JsPopUpView.OpenDetailView(21,{ID_CurrentObject:t.column.ID_Column,fullScreen:!0})}});return}t.row!==undefined?(c.IsFormReadOnly!==!0,t.row.rowType==="data"&&(r=t.component,e=r.getSelectedRowsData(),e.length<2&&r.selectRowsByIndexes([t.rowIndex]),c.IsFormReadOnly!==!0&&t.items.push({text:"Delete item",icon:"red fa fa-times",onItemClick:function(){var n=t.component.getSelectedRowsData();if(n.length>0){if(c.onBeforeDeleteDetail!==undefined)c.onBeforeDeleteDetail(t.component,n,h);c.DeleteDetails(t.component,n,h)}}}),c.IsFormReadOnly!==!0&&f!==-1&&t.items.unshift({text:"Open Detail",icon:"fa fa-folder-open",onItemClick:function(){var n=angular.copy(t.row.data);c.OpenOnNewWindow(f,n).then(function(n){c.$scope.CurrentObject[i][t.rowIndex]=n;c.$timeout(function(){t.component.repaint()})})}}))):(t.items==null&&(t.items=[]),h!==null&&(u=c.$scope[i+"_MenuOptions"],u!==undefined&&$.each(u,function(n,i){t.items.unshift(i)})));c["onContextMenuPreparing_"+i]!==undefined&&c["onContextMenuPreparing_"+i](t)}}};c.GetDeveloperMenuOptions=function(n){return{text:"Developers Mode",align:"right",color:"#588C7E",icon:"mdi mdi-codepen",isSystem:!0,items:[{text:"Edit ListView",icon:"icon mdi mdi-border-outside",onItemClick:function(){c.EditListViewControl(n.ID_ModelListView)}},{text:"Edit ModelView",icon:"icon mdi mdi-border-outside",onItemClick:function(){c.EditModelObject(n.ID_PropertyModel)}},{text:"Save Format",icon:"icon mdi mdi-content-save",onItemClick:function(){var t=c.GetGridEditor(n.PropertyName);c.SaveListViewFormat(n.Name,t.state(),n.ID_ModelListView)}},{text:"Batch Edit "+c.ModelName+" ListView",icon:"icon mdi mdi-table-large",isDeveloperMode:!0,onItemClick:function(){c.EditOnSQLView(1,n.ID_ModelListView)}},{text:"Batch Edit "+c.ModelName+" Properties",icon:"icon mdi mdi-table-large",isDeveloperMode:!0,onItemClick:function(){c.EditModelOnSQLView(n.ID_PropertyModel)}},{text:"View Model Script",icon:"icon mdi mdi-script",isDeveloperMode:!0,onItemClick:function(){c.ViewModelScript()}}]}};c.IsNew=function(){return c.$scope.CurrentObject.ID===-1};y=c.IsEditingOnly;y==!1&&(h=c.ViewAccess,h!==undefined&&h!==null&&(c.butSave={},c.butSaveClose={},c.butNew={},h.IsCanWrite==!1&&(c.$isAllowAdd=!1,c.$isAllowEdit=!1),h.IsCanEdit==!1&&(c.$isAllowEdit=!1),c.$isAllowAdd==!0&&(c.butNew={ID:i.TBTN_NEW,text:"New",icon:"fa fa-file-o"},c.$scope.FormContextMenuItems.push(c.butNew)),c.$isAllowEdit===!0&&(c.butSave={ID:i.TBTN_SAVE,color:"#28abe3",text:"Save",icon:"fa fa-save"},c.butSaveClose={ID:i.TBTN_SAVEANDCLOSE,color:"#ff0000",text:"Save & Close",icon:"fa fa-save",visible:!(c.IsModal==!0)},c.$scope.FormContextMenuItems.push(c.butSave),c.$scope.FormContextMenuItems.push(c.butSaveClose))),c.butRefresh={ID:i.TBTN_REFRESH,color:"#588c73",text:"Refresh",icon:"mdi mdi-refresh"},c.$scope.FormContextMenuItems.push(c.butRefresh));c.IsDeveloperMode&&c.$scope.FormContextMenuItems.push({ID:-1001,align:"right",color:"#588C7E",icon:"mdi mdi-codepen",items:[{ID:-1002,text:"Edit "+c.ModelViewName,icon:"icon mdi mdi-border-outside"},{ID:-1003,text:"Edit "+c.ModelName+" Model",icon:"icon mdi mdi-arrange-send-backward"},{ID:-1004,text:"Batch Edit ("+c.ModelViewName+")",icon:"icon mdi mdi-table-large"},{ID:-1005,text:"Batch Edit ("+c.ModelName+")",icon:"icon mdi mdi-table-large"},{text:"Publish Js",icon:"mdi mdi-language-javascript",isDeveloperMode:!0,onItemClick:function(){c.ConfirmBox("Do you want to publish script?","DetailView").then(function(){var n=angular.element(document).injector().get("$http");n.get("/JsApp/DetailView?ID="+c.ID_View+"&ViewName="+c.ModelViewName+"&isMinify=1").then(function(n){c.JSDataService.Post("/JsApp/PublishJs",{ID_View:c.ID_View,Script:n.data,ViewName:c.ModelViewName,ID_ViewType:2}).then(function(){})})})}}]});c.GetGridMenuOption=function(n){return{bindingOptions:{dataSource:n.dataSource},onInitialized:function(n){$.each(n.component._options.items,function(n,t){t.disabled===undefined&&(t.disabled=!1)});c.ChildToolbars===undefined&&(c.ChildToolbars=[]);c.ChildToolbars.push(n.component)},onItemClick:function(n){var t=n.itemData;n.itemData.onItemClick!==undefined&&n.itemData.onItemClick()}}};c.$scope.FormContextMenu={bindingOptions:{dataSource:"FormContextMenuItems"},itemTemplate:function(n,t,i){return(n.align==="right"&&($(i).parent().parent().css("float","right"),$(i).parent().parent().addClass("jsContextMenuRight")),n.icon===undefined&&n.icon==null&&(n.icon="mdi mdi-file-outline"),n.color===undefined&&n.color==null&&(n.color="#767676"),n.text===undefined)?"<div class='JsContextMenu'><div class='icon-container' style='background:"+n.color+"'><span class='"+n.icon+"'><\/span><\/div><\/div>":"<div class='JsContextMenu' style='display:table-cell;vertical-align:middle;background:transparent'><div class='item-content'><span style='color:"+n.color+"' class='"+n.icon+"'><\/span> <div class='item-caption'>"+n.text+"<\/div>"+(n.items!==undefined&&n.items!==null?'<span class="fa fa-caret-down"><\/span>':"")+"<\/div>"},displayExpr:"name",onInitialized:function(n){$.each(n.component._options.items,function(n,t){t.disabled===undefined&&(t.disabled=!1)});c.MainToolbar=n.component},onItemClick:function(n){if(n.itemData.onItemClick!==undefined){n.itemData.onItemClick([c.$scope.CurrentObject]);return}switch(n.itemData.ID){case i.TBTN_NEW:c.PerformNew();break;case i.TBTN_SAVE:c.PerformSave();break;case i.TBTN_SAVEANDCLOSE:c.$scope.$Tab!==undefined&&(c.$scope.$Tab.$forceClose=!0);c.PerformSave();break;case i.TBTN_REFRESH:c.RefreshCurrentObject();break;case-1002:c.EditDetailViewControl(c.ID_ModelObject);break;case-1003:c.EditModelObject(c.ID_Model);break;case-1004:c.EditOnSQLView(2,c.ID_ModelObject);break;case-1005:c.EditModelOnSQLView(c.ID_Model)}if(c.onMenuItemClick!==undefined)c.onMenuItemClick(n)}};c.GetAutoCompleteDataSource=function(n,t){return new DevExpress.data.DataSource({load:function(i){var e=i.skip==undefined?0:i.skip,r=i.searchValue,o=i.searchExpr!==null&&i.searchExpr!==undefined?typeof i.searchExpr=="string"?i.searchExpr:i.searchExpr.join():null,f=c.$q.defer(),u=[];return r=r.replace(/'/g,'"'),$.each(t,function(n,t){u.push(" "+t+" LIKE '%"+r+"%' ")}),u.length===0&&u.push("Name LIKE '%"+r+"%' "),c.JSDataService.Query(n,{FilterExpr:u.join(" OR ")},e).then(function(n){f.resolve(n.collection)}),f.promise}})};c.GetControlDataSource=function(n){return new DevExpress.data.DataSource({load:function(t){var r=t.skip==undefined?0:t.skip,u=t.searchValue,f=t.searchExpr!==null&&t.searchExpr!==undefined?typeof t.searchExpr=="string"?t.searchExpr:t.searchExpr.join():null,i=c.$q.defer();return c.JSDataService.GetDataSet("/JsApp/GetDataCollection",{SearchExpr:f,SearchValue:u,SQL:n,Skip:r}).then(function(n){i.resolve(n.collection)}),i.promise},byKey:function(t){var i=c.$q.defer();return c.JSDataService.GetDataSet("/JsApp/GetDataCollection",{Key:t,SQL:n}).then(function(n){i.resolve(n.collection[0])}),i.promise}})};c.AddRemoteValidationRule=function(n,t){c.ValidationRules.push(function(){return c.JSDataService.Validate(n,t)})};c.$scope.OnEditDone=function(){var n=c.PerformValidation();if(n.then!==undefined)n.then(function(n){if(n.isValid===!1){c.ShowValidation(n.brokenRules);return}c.$scope.OnEditingDone()});else{if(n.isValid===!1){c.ShowValidation(n.brokenRules);return}c.$scope.OnEditingDone()}};c.EditModelDetail_Setting=function(n){this.JsPopUpView.OpenDetailView(20,{ID_CurrentObject:n,fullScreen:!0})};c.FormItem_CurrentObjectChanged=function(n){if(c.IsFormReadOnly!==!0){if(c.FormInstance!==undefined){var t=c.FormInstance.option("$EditableProperties");t!==undefined&&$.each(t,function(t,i){if(n.dataField===i){if(c.FormInstance.getEditor(i)===undefined)return;c["$"+i+"_OnValueChanged"]!==undefined&&c["$"+i+"_OnValueChanged"](n)}})}$.each(c.DetailViewForms,function(t,i){var r=i.option("$EditableProperties");r!==undefined&&$.each(r,function(t,r){if(n.dataField===r){if(i.getEditor(r)===undefined)return;c["$"+r+"_OnValueChanged"]!==undefined&&c["$"+r+"_OnValueChanged"](n)}})})}};c.FormItem_EnabledDisabled=function(){if(c.IsFormReadOnly!==!0){if(c.FormInstance!==undefined){var n=c.FormInstance.option("$EditableProperties");n!==undefined&&$.each(n,function(n,t){if(c.FormInstance.getEditor(t)!==undefined&&c["$"+t+"_IsDisabled"]!==undefined){var i=c["$"+t+"_IsDisabled"]();c.FormInstance.getEditor(t).option("disabled",!i)}})}$.each(c.DetailViewForms,function(n,t){var i=t.option("$EditableProperties");i!==undefined&&$.each(i,function(n,i){if(t.getEditor(i)!==undefined&&c["$"+i+"_IsDisabled"]!==undefined){var r=c["$"+i+"_IsDisabled"]();t.getEditor(i).option("disabled",!r)}})})}};c.OnKeyDown=function(n){switch(n.keyCode){case 78:n.altKey==!0&&(n.preventDefault(),c.PerformNew());break;case 82:n.altKey==!0&&c.RefreshCurrentObject();break;case 83:n.ctrlKey==!0&&(n.preventDefault(),n.altKey==!0?(c.$scope.$Tab!==undefined&&(c.$scope.$Tab.$forceClose=!0),c.PerformSave()):c.PerformSave());break;case 112:n.preventDefault();c.$timeout(function(){r.PageSlideViewOpen.Open=!r.PageSlideViewOpen.Open},100)}};r.$Tab!==undefined&&(r.$Tab.onTab_KeyDown=c.OnKeyDown);c.IsModal===!0&&(r.$onModalKeyDown=c.OnKeyDown);r.onFileUploadClick=function(n){c.$scope.CurrentObject.ID>0&&$("<form/>").attr({method:"post",target:"_blank",action:"JsApp/GetAttachments"}).append($("<input type='hidden' name='ID_Model'/>").attr("value",-1)).append($("<input type='hidden' name='PropertyName'/>").attr("value","xxxx")).append($("<input type='hidden' name='ID_CurrentObject'/>").attr("value",c.$scope.CurrentObject.ID)).append($("<input type='hidden' name='ID_Detail'/>").attr("value",n)).appendTo("body").submit().remove()};r.isHideAttachment=function(n){return typeof c.$scope.CurrentObject[n]=="string"&&c.$scope.CurrentObject[n].length>0?!1:!0};r.OnFileUploader_FileClick=function(n){var t=Enumerable.From(c.$FilesToUpload).Where("$.propertyName =='"+n+"'").SingleOrDefault();(t===null||t===undefined)&&c.$scope.CurrentObject.ID>0&&c.$scope.CurrentObject[n]!==null&&$("<form/>").attr({method:"post",target:"_blank",action:"JsApp/GetAttachments"}).append($("<input type='hidden' name='ID_Model'/>").attr("value",c.ID_Model)).append($("<input type='hidden' name='PropertyName'/>").attr("value",n)).append($("<input type='hidden' name='ID_CurrentObject'/>").attr("value",c.$scope.CurrentObject.ID)).appendTo("body").submit().remove()};c.$fileUploaders=[];c.$fileUploadersRequiredList=[];c.OnFileUploader_Initialized=function(n,t,i,r){c.$fileUploaders.push(t);r===!0&&c.$fileUploadersRequiredList.push({propertyName:n,caption:i})};c.OnFileUploader_OnValueChanged=function(t,i,r){var u,f;i.value.length>0?(c.$FilesToUpload==null&&(c.$FilesToUpload=[]),u=Enumerable.From(c.$FilesToUpload).Where("$.propertyName =='"+t+"'").SingleOrDefault(),r===!0?(f=n.getRandomInt()+"",$.each(i.value,function(n,t){t.ID_Parent=f}),u!=null?u={id:f,propertyName:t,fileName:Enumerable.From(i.value).Select("$.name").ToArray().join(","),file:i.value,isImage:!1,IsMultiple:!0}:c.$FilesToUpload.push({propertyName:t,fileName:Enumerable.From(i.value).Select("$.name").ToArray().join(","),file:i.value,isImage:!1,IsMultiple:!0})):u==null?c.$FilesToUpload.push({propertyName:t,fileName:i.value[0].name,file:i.value[0],isImage:!1}):(u.fileName=i.value[0].name,u.file=i.value[0]),c.$timeout(function(){c.$scope.CurrentObject[t]=i.value[0].name})):c.$FilesToUpload!==null&&$.each(c.$FilesToUpload,function(n,r){if(r.fileName===i.value.name)return c.$FilesToUpload.splice(n,1),c.$timeout(function(){c.$scope.CurrentObject[t]=null}),!1})}},i.prototype.PerformValidation=function(){var n=this,t,i;return n.ValidationRules.length>0?(t=n.$q.defer(),i=[],$.each(n.ValidationRules,function(n,t){i.push(t.call())}),n.$q.all(i).then(function(i){console.log("-->Validation",i);n.$timeout(function(){for(var o,u,e=n.IsValid(),r={isValid:e.isValid,brokenRules:[]},f=0;f<i.length;f++)o=i[f],u=o,u.isValid==!1&&(u.brokenRules!==undefined?$.each(u.brokenRules,function(n,t){r.brokenRules.push({type:"custom",message:t})}):r.brokenRules.push({type:"custom",message:u.message}),r.isValid=!1);$.each(e.brokenRules,function(n,t){r.brokenRules.unshift(t)});t.resolve(r)})}),t.promise):n.IsValid()},i.prototype.IsValid=function(){var n=this,f=[n.FormInstance],r,o,u,s;$.each(n.DetailViewForms,function(n,t){f.push(t)});var t=!0,i=[],e=[];for(r=0;r<f.length;r++){o=f[r];try{u=DevExpress.validationEngine.validateGroup(o);e.push({isValid:u.IsValid});u.isValid==!1&&($.each(u.brokenRules,function(n,t){t.message.includes("is invalid")==!1&&i.push(t)}),t==!0&&(t=!1))}catch(h){e.push({isValid:!0})}}return n.$fileUploadersRequiredList.length>0&&$.each(n.$fileUploadersRequiredList,function(t,r){(n.$scope.CurrentObject[r.propertyName]===undefined||n.$scope.CurrentObject[r.propertyName]===null)&&i.push({type:"required",message:"Please attach files "+r.caption})}),n.$HotTableList!==undefined&&n.$HotTableList!==null&&$.each(n.$HotTableList,function(n,r){var u=Enumerable.From(r.view.settings.columns).Where("$.IsRequired == true").ToArray(),f=r.view.settings.data;$.each(f,function(n,r){r.$IsNewRow!==!0&&$.each(u,function(u,f){r[f.data]!=null?f.type===undefined&&r[f.data].trim().length===0&&(t=!1,i.push({type:"required",message:"("+n+") "+f.data+" is required"})):(t=!1,i.push({type:"required",message:"("+n+") "+f.data+" is required"}))})});r.validateCells(function(){})}),n.PropertyGridEditors!==null&&n.PropertyGridEditors.length>0&&(s=[],$.each(n.PropertyGridEditors,function(r,u){var o=u.option("columns"),e=Enumerable.From(o).Where(function(n){if(n.validationRules!==undefined&&n.validationRules.length>0)return!0}).ToArray(),f;e.length>0&&(f=n.$scope.CurrentObject[u.PropertyName],f!==undefined&&f!==null&&$.each(f,function(n,r){$.each(e,function(n,f){var e=r[f.dataField];$.each(f.validationRules,function(n,r){r.type=="required"?e==null||e==undefined?(t=!1,i.push({type:"required",message:u.Caption+"("+(n+1)+") "+r.message})):f.dataType==="number"&&e===0&&f.isAllowZero===!1&&(t=!1,i.push({type:"required",message:u.Caption+"("+(n+1)+") "+r.message})):r.type=="custom"})})}))})),i.length==0&&(t=!0),{isValid:t,brokenRules:i}},i.prototype.PerformSave=function(){var n=this,i,t;n.$scope.IsNewObject=!1;i=function(t){if(t.isValid===!1){n.ShowValidation(t.brokenRules);return}n.$scope.CurrentObject.ID===-1?n.Save():n.$PromptBeforeSave===!1?n.Save():DevExpress.ui.dialog.confirm("Do you want to save changes?","Save "+n.ModelName).done(function(t){t&&n.Save()})};t=n.PerformValidation();t.then!==undefined?t.then(function(n){i(n)}):i(t)},i.prototype.Save=function(){var n=this,r=n.$q.defer(),f=n.$scope.CurrentObject.ID===-1,t=null,u,i;if(n.$FilesToUpload!==null&&(t=[],$.each(n.$FilesToUpload,function(n,i){i.file instanceof Array?$.each(i.file,function(n,i){t.push(i)}):t.push(i.file);i.file=null})),n.$IsSaving===!1)n.$IsSaving=!0;else return;(n.$dateFields===undefined||n.$dateFields===null)&&(n.$dateFields=[]);n.$dateFields.push("Date");n.$dateFields.push("StartTime");n.$dateFields.push("EndDate");n.$dateFields.push("StartDate");n.$dateFields.push("MemoDate");n.$dateFields.push("EndTime");n.$dateFields.push("CheckDate");n.$dateFields.push("Schedule_StartDate");n.$dateFields.push("Schedule_EndDate");n.$dateFields.push("Schedule_StartTime");n.$dateFields.push("Schedule_EndTime");n.$dateFields=Enumerable.From(n.$dateFields).Distinct().ToArray();!n.$dateFields||$.each(n.$dateFields,function(t,i){var r;!n.$scope.CurrentObject[i]||n.$scope.CurrentObject[i]!==null&&(typeof n.$scope.CurrentObject[i]=="string"?(r=Globalize.format(new Date(n.$scope.CurrentObject[i]),"yyyy/MM/dd HH:mm:ss"),n.$scope.CurrentObject[i]=r):typeof n.$scope.CurrentObject[i]=="object"&&(r=Globalize.format(n.$scope.CurrentObject[i],"yyyy/MM/dd HH:mm:ss"),n.$scope.CurrentObject[i]=r))});for(u in n.$scope.CurrentObject)i=n.$scope.CurrentObject[u],i!==null&&i instanceof Array&&$.each(i,function(t,i){var r,u;for(r in i)typeof i[r]=="string"?n.$dateFields.includes(r)==!0&&(u=Globalize.format(new Date(i[r]),"yyyy/MM/dd HH:mm:ss"),i[r]=u):typeof i[r]=="object"&&n.$dateFields.includes(r)==!0&&i[r]!=null&&(u=Globalize.format(i[r],"yyyy/MM/dd HH:mm:ss"),i[r]=u,console.log(r,typeof i[r],i[r]))});return n.JSDataService.SaveModelObject(n.SaveUrl,{ID:n.ID_ModelObject,CurrentObject:JSON.stringify(n.$scope.CurrentObject),ViewName:n.ModelViewName,_DeletedItems:JSON.stringify(n._DeletedItems),$files:t,$filesDetails:JSON.stringify(n.$FilesToUpload)}).then(function(t){if(n.$IsSaving=!1,n.ToastSuccess("Save Successful"),n._DeletedItems={},n.CloseAfterSave!==undefined&&n.CloseAfterSave==!0&&n.$timeout(function(){n.$scope.ClosePopup(!0)},500),n.$isReloadCurrentObject=!0,n.$scope.CurrentObject=t,$.each(n.DetailViewForms,function(t,i){i.option("formData",n.$scope.CurrentObject)}),n.FormInstance.option("formData",n.$scope.CurrentObject),n.$scope.CurrentObject.$dirty=!1,n.$scope.CurrentObject.CRUD=n.CRUDTablesIds,n.ModelHelper!==undefined){n.ModelHelper.CurrentObject=n.$scope.CurrentObject;n.ModelHelper.onCurrentObjectSaved(n.$scope.CurrentObject)}if(n.ViewHelper!==undefined){n.ViewHelper.CurrentObject=n.$scope.CurrentObject;n.ModelHelper.onCurrentObjectSaved(n.$scope.CurrentObject)}if(f&&n.$scope.$Tab!==undefined&&n.$scope.$Tab.id<0&&n.$timeout(function(){n.$scope.$Tab.title=n.DisplayName+" ("+t[n.DisplayProperty]+")";n.$scope.DisplayPropertyName=" ("+t[n.DisplayProperty]+")"},300),n.$ViewOptions!==null&&n.$ViewOptions!==undefined){if(n.$ViewOptions.$onCurrentObjectSaved!==undefined&&n.$ViewOptions.$onCurrentObjectSaved!==null&&n.$ViewOptions.$onCurrentObjectSaved(n.$scope.CurrentObject,n),n.$scope.$Tab!==undefined&&n.$scope.$Tab.$forceClose==!0){n.$timeout(function(){n.$scope.$Tab.CloseModule()},500);return}if(n.$ViewOptions.$ClosedAfterSaved===!0){n.ConfirmBox("Do you want to close this "+(n.$scope.$Tab!==undefined?"Tab":"Window")+"?").then(function(){n.$timeout(function(){n.$scope.$Tab.CloseModule()},500)},function(){n.$scope.StatusText="Successfully Saved";n.onLoad()});return}}else if(n.$scope.$Tab!==undefined&&n.$scope.$Tab.$forceClose==!0){n.$timeout(function(){n.$scope.$Tab.CloseModule()},500);return}n.$scope.StatusText="Successfully Saved";n.onLoad();r.resolve()},function(){n.$IsSaving=!1;r.reject()}),r.promise},i.prototype.Reload=function(n){var t=this,r=t.$q.defer(),i;return n==undefined&&(n=t.$scope.CurrentObject.ID),i=t.$scope.$params,t.JSDataService.GetCurrentObject(t.ReloadUrl,{ID:t.ID_ModelObject,ViewName:t.ModelViewName+"_DetailView_"+n,ID_CurrentObject:n,DataSource:t.$ViewOptions.DataSource,params:i!==null&&i!==undefined?JSON.stringify(i):null}).then(function(i){n==-1&&($.each(t.DetailViewForms,function(n,t){t.resetValues()}),t.FormInstance.resetValues());t.$timeout(function(){t.$isReloadCurrentObject=!0;t.$scope.CurrentObject=i;t.$scope.CurrentObject.$dirty=!1;t.$scope.CurrentObject.CRUD=t.CRUDTablesIds;t.ModelHelper!==undefined&&(t.ModelHelper.CurrentObject=t.$scope.CurrentObject);t.ViewHelper!==undefined&&(t.ViewHelper.CurrentObject=t.$scope.CurrentObject);$.each(t.DetailViewForms,function(n,i){i.option("formData",t.$scope.CurrentObject)});t.FormInstance.option("formData",t.$scope.CurrentObject);t.onLoad();r.resolve()},500)}),r.promise},i.prototype.RefreshCurrentObject=function(){var n=this;DevExpress.ui.dialog.confirm("Reload Current "+n.ModelName+"?","Load "+n.ModelName).done(function(t){t&&n.Reload()})},i.prototype.PerformNew=function(){var n=this;n.$PromptBeforeSave===!1?n.Reload(-1):DevExpress.ui.dialog.confirm("Create New "+n.ModelName+"?","New ").done(function(t){t&&n.Reload(-1)})},i.prototype.onLoad=function(){var n=this,t;n.$FilesToUpload=[];n.$fileUploadersRequiredList=[];n.$fileUploaders!==undefined&&n.$fileUploaders!==null&&n.$fileUploaders.length>0&&$.each(n.$fileUploaders,function(t,i){var r;i.reset!==undefined?(n.$scope.CurrentObject.ID>-1&&i.PROPERTYNAME!==undefined&&(r=n.$scope.CurrentObject[i.PROPERTYNAME],!r||(i.skipImage=!0)),i.reset()):(n.$scope.CurrentObject.ID>-1&&i.component.PROPERTYNAME!==undefined&&(r=n.$scope.CurrentObject[i.component.PROPERTYNAME],!r||(i.component.skipImage=!0)),i.component.reset())});n.$timeout(function(){n.$imgControls!==undefined&&n.$imgControls!==null&&n.$imgControls.length>0&&$.each(n.$imgControls,function(t,i){var e=i.PROPERTYNAME,u=i.$ImgControl,f=$(u).attr("src"),r;(f==undefined||f==null)&&(r=n.$scope.CurrentObject[e],!r||$(u).attr("src",r))})},1e3);n.$scope.CurrentObject.$dirty=!1;n.$scope.CurrentObject.ID>-1;n._DeletedItems={};n.ModelHelper!==undefined&&(n.ModelHelper.CurrentObject=n.$scope.CurrentObject,n.ModelHelper.onLoad());n.ViewHelper!==undefined&&(n.ViewHelper.CurrentObject=n.$scope.CurrentObject,n.ViewHelper.onLoad());n.IsFormReadOnly!==undefined&&(n.butSave!==undefined&&(n.butSave.disabled=n.IsFormReadOnly),n.butSaveClose!==undefined&&(n.butSaveClose.disabled=n.IsFormReadOnly));n.$scope.CurrentObject.ID>0?n.$scope.DataInformationText=n.$scope.CurrentObject.DateCreated!==undefined?"Created by "+n.$scope.CurrentObject.CreatedBy+" on "+moment(n.$scope.CurrentObject.DateCreated).format("MMMM D, YYYY h:mm:ss A"):"Created by "+n.$scope.CurrentObject.CreatedBy:(n.$scope.DataInformationText="(New Record)",n.$imgControls!==undefined&&n.$imgControls!==null&&n.$imgControls.length>0&&$.each(n.$imgControls,function(n,t){var i=t.$ImgControl;$(i).removeAttr("src")}));n.PropertyGridEditors!==undefined&&n.PropertyGridEditors!==null&&$.each(n.PropertyGridEditors,function(t,i){n.$scope.CurrentObject[i.PropertyName]!=null?Array.isArray(n.$scope.CurrentObject[i.PropertyName])!==!0&&(n.$scope.CurrentObject[i.PropertyName]=[]):n.$scope.CurrentObject[i.PropertyName]=[];i.clearSelection()});n.$GridControlList!==undefined&&n.$GridControlList!==null&&$.each(n.$GridControlList,function(n,t){t.clearSelection();t.refresh()});n.$HotTableList!==null&&n.$HotTableList!==undefined&&$.each(n.$HotTableList,function(n,t){t.render()});t=n.ViewAccess;t!==undefined&&t!==null&&(t.IsCanWrite==!1&&n.$scope.CurrentObject.ID==-1&&(n.butSave.disabled=!0,n.butSaveClose.disabled=!0),t.IsCanEdit===!1&&n.$scope.CurrentObject.ID>0&&(n.butSave.disabled=!0,n.butSaveClose.disabled=!0));n.FormItem_EnabledDisabled();n.RefreshToolBar();n.$MainTab!==undefined&&n.$MainTab.option("selectedIndex",0);n.$OtherTabs!==undefined;n.$timeout(function(){var t=n.FormInstance.getEditor(n.firstFieldIndex);t!==undefined&&t!==null&&t.focus()},500)},i.prototype.CurrentObject_FieldDataChanged=function(n){var t=this;if(t.ModelHelper!==undefined&&t.ModelHelper.onCurrentObjectChanged!==undefined)t.ModelHelper.onCurrentObjectChanged(n);if(t.ViewHelper!==undefined&&t.ViewHelper.onCurrentObjectChanged!==undefined)t.ViewHelper.onCurrentObjectChanged(n);t.FormItem_EnabledDisabled();t.FormItem_CurrentObjectChanged(n)},i.prototype.OnFormInitialized=function(){var n=this;n.ModelHelper!==undefined&&n.ModelHelper.OnFormInitialized!==undefined&&n.ModelHelper.OnFormInitialized(n);n.ViewHelper!==undefined&&n.ViewHelper.OnFormInitialized!==undefined&&n.ViewHelper.OnFormInitialized(n)},i.prototype.DeleteDetails=function(n,t,i){var r=this,u=DevExpress.ui.dialog.confirm("Do you want to delete item(s)?",r.ModelName);u.done(function(u){var s,c,f;if(u!==!1){r._DeletedItems[n._options.propertyName]===undefined&&(r._DeletedItems[n._options.propertyName]=[]);var e=null,o=undefined,h=n._options.propertyName;if(r[h+"_IsCanDelete"]===undefined||r[h+"_IsCanDelete"](t)!=!1){if(i!==undefined&&i!==null){if(s=r.GetGridEditor(i),s.getSelectedRowsData().length===0)return;o=s.getSelectedRowsData()[0]}o!==undefined?o!==null&&(c=o,e=c[n._options.propertyName],f=[],$.each(t,function(t,i){f.push(e.indexOf(i));i.ID>0&&r._DeletedItems[n._options.propertyName].push(jQuery.extend({},i))}),$.each(f,function(t,i){r.$timeout(function(){n.deleteRow(i);r.OnDetailGrid_RowDeleted!==undefined&&r.OnDetailGrid_RowDeleted(n)})})):(e=r.$scope.CurrentObject[n._options.propertyName],f=[],$.each(t,function(t,i){f.push(e.indexOf(i));i.ID>0&&r._DeletedItems[n._options.propertyName].push(jQuery.extend({},i))}),$.each(f,function(t,i){r.$timeout(function(){n.deleteRow(i);r.OnDetailGrid_RowDeleted!==undefined&&r.OnDetailGrid_RowDeleted(n)})}));r.$scope.CurrentObject.$dirty=!0}}})},i});