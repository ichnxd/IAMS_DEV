define(["baseView"],function(n){"use strict";function t(){}return t.prototype=Object.create(n.prototype),t.prototype.Init=function(t,i,r,u){var e,f,o,s,a,v,h,c,l;if(n.prototype.Init.call(this,t),e=!1,f=this,f.LvModel=r,f.ViewAccess=u,f.$Summary={},f.ID_Model=r.ID_Model,f.ID_View=r.ID_View,f.ModelName=r.DisplayName,f.DisplayName=r.DisplayName,f.OwnerRightsField="ID_CreatedBy",f.OwnerRightsValueField="ID",f.$SearValueText=null,f.dxSearchBox=null,f.$scope.txtSearhBoxOption={placeholder:"Search "+f.LvModel.DisplayName,mode:"search",width:250,showClearButton:!0,onInitialized:function(n){f.dxSearchBox=n.component;f.$timeout(function(){f.dxSearchBox.focus()},500)},onEnterKey:function(){f.Grid.refresh()},onValueChanged:function(n){f.$SearValueText=n.value}},t.onKeyDown=function(n){if(n.altKey==!0)if(n.keyCode===78){if(n.stopPropagation(),n.preventDefault(),u.IsCanWrite==!1)return;f._OpenDetailView(-1)}else n.keyCode===82&&f.Grid.refresh()},t.InitView=function(){},o=[],s=function(n){var t="";return $.each(n,function(i,r){if($.isArray(r))t+=" ("+s(r)+") ";else{var u="";i%2==1&&(u=r==="contains"||r==="startswith"||r==="endswith"?"LIKE":r.toUpperCase());i===0?u=r:i===2&&(jQuery.type(r)==="string"?(r=r.replace(/'/g,"''"),u=n[1]==="contains"?"'%"+r+"%'":n[1]==="startswith"?"'"+r+"%'":n[1]==="endswith"?"'%"+r+"'":"'"+r+"'"):u=jQuery.type(r)==="date"?"'"+moment(r).format("YYYY-MM-DD")+"'":jQuery.type(r)==="boolean"?r==!0?"1":"0":r);t+=" "+u}}),t},f.ToggleHeaderFilter=function(){var n=f.Grid.option("headerFilter.visible");f.Grid.option("headerFilter.visible",!n)},f.ToggleFilterRow=function(){var n=f.Grid.option("filterRow.visible");f.Grid.option("filterRow.visible",!n)},f.ToggleGroupPanel=function(){var n=f.Grid.option("groupPanel.visible");f.Grid.option("groupPanel.visible",!n)},f.Reset=function(){f.Grid.clearFilter();f.Grid.clearGrouping();f.Grid.clearSorting()},u.IsCanWrite==!1&&f.ButNew!==undefined&&(f.ButNew.visible=!1),f.addColumnClass=function(n,t,i,r){n.addClass(r)},f.addColumnClassMapping=function(n,t,i,r,u){var f,e;n.addClass(r);f=i[t];(f!==undefined||f!==null)&&(e=Enumerable.From(u).Where("$.ID ==="+f).SingleOrDefault(),e!==undefined&&e!==null&&n.addClass(e.Value))},f.SetOwnerRightsFilter=function(){var n=null,r,t,i;return f.ViewAccess.OwnerRights!==undefined&&f.ViewAccess.OwnerRights!==null&&f.ViewAccess.OwnerRights[0].IsDeveloper!==1&&f.ViewAccess.OwnerRights.length>1&&(r=Enumerable.From(f.ViewAccess.OwnerRights).Where("$.ID === -1000").SingleOrDefault(),r==null&&(t=Enumerable.From(f.ViewAccess.OwnerRights).Where("$.IsDeny !== true").ToArray(),t.length>1&&(n!=null?n+=" AND ":n="",n+=" "+f.OwnerRightsField+" IN ("+Enumerable.From(t).Select("$."+f.OwnerRightsValueField).ToArray().join()+")")),i=Enumerable.From(f.ViewAccess.OwnerRights).Where("$.IsDeny === true").ToArray(),i.length>0&&(n!=null?n+=" AND ":n="",n+=" "+f.OwnerRightsField+" NOT IN ("+Enumerable.From(i).Select("$."+f.OwnerRightsValueField).ToArray().join()+")")),n},f.$scope.dataGridOptions={dataSource:{load:function(n){var y=f.$q.defer(),i=null,o,h,c,p,w,t,l,a,v;n.filter!=undefined&&(i="("+s(n.filter)+")");o=f.Grid.FilterListData;for(h in o)o.hasOwnProperty(h)&&o[h]!=null&&o[h].length>0&&(i!=null&&(i+=" AND "),i=(i==null?"":i)+"["+h+"] IN ("+o[h].join(",")+")");if(c=f.SetOwnerRightsFilter(),c!==null&&c.length>0&&(i!=null?i+=" AND ":i="",i+=" "+c),p=null,n.sort!==undefined&&n.sort!==null&&$.each(n.sort,function(n,t){p=t.selector+" "+(t.desc===!0?"DESC":"")}),w=Enumerable.From(f.$SearchColumns).Where("$.ID ==="+f.$scope.ColumnSearchExpr).SingleOrDefault(),t={ID:r.ID_ModelObject,ViewName:r.ModelViewName,skip:n.skip==undefined?0:n.skip,IsExport:e,filter:i,FilterString:f.$scope.FilterString!==undefined?f.$scope.FilterString:null,SortingExpr:p,FullTextSearch:f.$SearValueText,pageSize:f.LvModel.PageSize,DataSource:r.DataSource,IsOwner:f.IsHasCreatedByColumn===!0&&u.IsOwner===!0,ColumnSearhOption:w.ID===-1?undefined:w.PropertyName},f.ModelHelper!==undefined&&f.ModelHelper.onCollectionSource_Load!==undefined){t.WhereCriteria==undefined&&(t.WhereCriteria=[]);f.ModelHelper.onCollectionSource_Load(t);t.WhereCriteria.length>0&&(t.FilterString=t.WhereCriteria.join(" AND "))}if(f.ViewHelper!==undefined&&f.ViewHelper.onCollectionSource_Load!==undefined){t.WhereCriteria==undefined&&(t.WhereCriteria=[]);f.ViewHelper.onCollectionSource_Load(t);t.WhereCriteria.length>0&&(t.FilterString=t.WhereCriteria.join(" AND "))}if(l=[],f.$scope.dataGridOptions.summary.totalItems.length>1){for(a=1;a<f.$scope.dataGridOptions.summary.totalItems.length;a++)v=f.$scope.dataGridOptions.summary.totalItems[a],l.push({name:v.showInColumn,operator:v.type+"("+v.showInColumn+")"});t.SummaryColumns=JSON.stringify(l)}return f.JSDataService.GetDataSet("ListView/GetDataSet",t).then(function(n){f.$timeout(function(){n.summaries!=null&&(f.TotalRecordCount=n.summaries.RecordCount,$.each(l,function(t,i){f.$Summary[i.name]=n.summaries[i.name]}));e==!0&&(e=!1);y.resolve(n.collection)},100)},function(){y.reject(null)}),y.promise},totalCount:function(){return 0}},noDataText:"",height:"100%",scrolling:{mode:"infinite"},sorting:{mode:"single"},"export":{fileName:r.ModelName+""+moment(new Date).format("MMDDYYYYHHmm")},loadPanel:{enabled:!1},columnResizingMode:"widget",allowColumnResizing:!0,columnChooser:{height:400,width:250},stateStoring:{enabled:!1,type:"localStorage",storageKey:r.ModelName+"storage"+r.ID},customizeColumns:function(n){f.onCustomizeColumns(n);$.each(n,function(n,t){(t.showWhenGrouped=!1,t.dataField!==undefined)&&(t.dataField==="ID"||t.caption==="ID"?(t.caption="ID",t.allowHiding=!1,t.allowGrouping=!1,t.allowReordering=!1,t.allowResizing=!1,f.IsDeveloperMode!==!0&&(t.visible=!1),t.allowHiding=!1):f.LvModel.firstColumn===t.dataField,t.dataField!=="ID"&&t.dataField!==f.$SummaryColumnName)&&(t.allowFixing=!0,t.allowResizing=!0,t.width>=0&&t.width<=70&&(t.width=t.width+30),t.dataType==="date"&&t.format!==null&&t.format!==undefined&&(t.cellTemplate=function(n,i){var r=i.data[t.dataField];r?n.html(Globalize.format(new Date(r),t.format)):n.html("")}))});var t=Enumerable.From(n).Where("$.visible == true && $.fixed !== true").OrderByDescending("$.visibleIndex").ToArray();t[0].width=undefined},remoteOperations:{filtering:!0,paging:!0,summary:!0,sorting:!0},paging:{pageSize:f.LvModel.PageSize},selection:{mode:"multiple",showCheckBoxesMode:r.IsModal?r.IsSingleSelect?"onLongTap":"always":"onLongTap"},onCellHoverChanged:function(){},onKeyDown:function(n){var i,r,u,t;if(n.jQueryEvent.keyCode==27&&n.component.clearSelection(),n.jQueryEvent.keyCode==13){if(i=n.component.getSelectedRowsData(),i.length!==1)return;f._OpenDetailView(i[0].ID,i[0])}(n.jQueryEvent.keyCode==38||n.jQueryEvent.keyCode==40)&&(r=n.component.getSelectedRowKeys(),r.length&&(u=r[0],t=n.component.getRowIndexByKey(u),n.jQueryEvent.keyCode==38?(t--,t>=0&&(n.component.selectRowsByIndexes([t]),n.jQueryEvent.stopPropagation())):n.jQueryEvent.keyCode==40&&(t++,n.component.selectRowsByIndexes([t]),n.jQueryEvent.stopPropagation())))},rowAlternationEnabled:!1,showRowLines:!0,summary:{totalItems:[]},hoverStateEnabled:!0,showBorders:!0,allowColumnReordering:!0,wordWrapEnabled:f.LvModel.IsWordWrap,filterRow:{visible:!0,applyFilter:"onClick"},headerFilter:{visible:!1},onInitialized:function(n){f.Grid=n.component;f.Grid.FilterListControl=[];f.Grid.clearSorting();f.$timeout(function(){f.Grid.clearFilter()},500);f.ModelHelper!=undefined&&(f.ModelHelper.Grid=f.Grid);f.ViewHelper!=undefined&&(f.ViewHelper.Grid=f.Grid);f.Grid.clearSelection();f.$scope.$Tab.$Refresh=function(){f.$timeout(function(){f.Grid.refresh()},300)};f.$scope.RepaintView===!0&&(f.$scope.RefreshView=function(){f.$timeout(function(){f.Grid.repaint()})});f.RefreshToolbar()},onEditorPreparing:function(n){n.parentType=="filterRow"&&(n.editorOptions.onEnterKey=function(){n.element.find(".dx-apply-button").trigger("dxclick")})},onSelectionChanged:function(n){var t=n.selectedRowKeys.length,i,r;t===1&&(i=n.component.getView("rowsView")._scrollable,r=n.component.element().find("tr.dx-selection"),i.scrollToElement(r));f.$scope.CurrentObject=t>0?n.selectedRowKeys[t-1]:null;f.RefreshToolbar()},onRowClick:function(n){var t=n.component;t.clickCount=t.clickCount?t.clickCount+1:1;t.clickCount==1?(t.lastClickTime=new Date,setTimeout(function(){t.lastClickTime=0;t.clickCount=0},350)):t.clickCount==2&&(new Date-t.lastClickTime<300&&n.data!==undefined&&(f._OpenDetailView(n.data.ID,n.data),f.$scope.ClosePopup!=undefined&&f.$scope.ClosePopup()),t.clickCount=0,t.lastClickTime=0)},onOptionChanged:function(){},onContentReady:function(n){if(f.$isHasMaxHeight==undefined){var i=n.element.find(".dx-datagrid-rowsview"),t=i.height()-65;i.css({"min-height":t,"max-height":t});f.$isHasMaxHeight=t}},onContextMenuPreparing:function(n){var i,t;if(n.items==null&&(n.items=[]),$.each(n.items,function(n,t){if(t.text==undefined)switch(t.value){case"asc":t.text="Sort Ascending";break;case"desc":t.text="Sort Descending";break;case"none":t.text="Clear Sorting"}}),n.jQueryEvent={},window.event!==undefined&&(n.jQueryEvent.ctrlKey=window.event.ctrlKey),n.jQueryEvent.ctrlKey==!0&&f.IsDeveloperMode==!0){n.items=[];n.items.push({align:"right",text:"Developers Mode",icon:"mdi mdi-codepen",color:"#588C7E",items:[{text:"Edit "+f.LvModel.ModelViewName,icon:"icon mdi mdi-border-outside",onItemClick:function(){f.EditListViewControl(f.LvModel.ID_ModelObject)}},{text:"Edit "+f.LvModel.DisplayName+" Model",icon:"icon mdi mdi-arrange-send-backward",onItemClick:function(){f.EditModelObject(f.LvModel.ID_Model)}},{text:"Save Format",icon:"icon mdi mdi-content-save",onItemClick:function(){f.SaveListViewFormat(f.LvModel.ModelViewName,f.Grid.state(),f.LvModel.ID_ModelObject)}},{text:"Batch Edit ("+r.ModelViewName+")",icon:"icon mdi mdi-table-large",onItemClick:function(){f.EditOnSQLView(1,f.LvModel.ID_ModelObject)}},{text:"Batch Edit ("+r.DisplayName+")",icon:"icon mdi mdi-table-large",onItemClick:function(){f.EditModelOnSQLView(f.LvModel.ID_Model)}},{text:"View Model Script",icon:"icon mdi mdi-script",isDeveloperMode:!0,onItemClick:function(){f.ViewModelScript()}},{text:"Publish Js",icon:"mdi mdi-language-javascript",isDeveloperMode:!0,onItemClick:function(){f.ConfirmBox("Do you want to publish script?","ListView").then(function(){var n=angular.element(document).injector().get("$http");n.get("/JsApp/ListView?ID="+f.LvModel.ID_ModelObject+"&ViewName="+f.LvModel.ModelViewName+"&isMinify=1").then(function(n){f.JSDataService.Post("/JsApp/PublishJs",{ID_View:f.LvModel.ID_ModelObject,Script:n.data,ViewName:f.LvModel.ModelViewName,ID_ViewType:1}).then(function(){})})})}}]});n.items.push({icon:"mdi mdi-settings-box",align:"right",text:"Settings",items:[{text:"Toggle Header Filter",onItemClick:function(){f.ToggleHeaderFilter()}},{text:"Toggle Filter Row",onItemClick:function(){f.ToggleFilterRow()}},{text:"Toggle Group Panel",onItemClick:function(){f.ToggleGroupPanel()}},{text:"Clear Sorting",onItemClick:function(){f.Grid.clearSorting()}},{text:"Clear Grouping",onItemClick:function(){f.Grid.clearGrouping()}},{text:"Reset",onItemClick:function(){f.Reset()}},]});n.items.push({align:"right",icon:"jspp-icon js-list",text:"Column Chooser",color:"#008bba",onItemClick:function(){f.Grid.showColumnChooser()}});n.items.push({text:"Edit Column ("+n.column.caption+")",icon:"mdi mdi-table-column-width",onItemClick:function(){f.JsPopUpView.OpenDetailView(21,{ID_CurrentObject:n.column.ID_Column,fullScreen:!0})}});n.column.ID_ModelProperty!==undefined&&n.items.push({text:"Edit Property ("+n.column.caption+")",icon:"mdi mdi-cube",onItemClick:function(){f.JsPopUpView.OpenDetailView(15,{ID_CurrentObject:n.column.ID_ModelProperty,fullScreen:!0})}});return}if(n.row!=undefined&&n.row.rowType==="data"){if(i=[{text:"Open in new tab",icon:"mdi mdi-tab",onItemClick:function(){f._OpenDetailView(n.row.data.ID,n.row.data);f.$scope.ClosePopup!=undefined&&f.$scope.ClosePopup()}},{text:"Open in new window",icon:"mdi mdi-window-restore",onItemClick:function(){f.OpenOnNewWindowByID(f.LvModel.ID_ModelDetailView,n.row.data.ID,{fullScreen:!0}).then(function(){f.$timeout(function(){f.Grid.refresh()},100)})}}],$.each(i,function(t,i){n.items==null&&(n.items=[]);n.items.push(i)}),t=Enumerable.From(f.$scope.ContextMenuItems).Where("$.isContextMenu == true").ToArray(),f.onContextMenuPreparing!=undefined)f.onContextMenuPreparing(n);t.length>0&&$.each(t,function(t,i){i.onItemClick===undefined&&f.onMenuItemClick!==undefined&&(i.onItemClick=function(){f.onMenuItemClick(i)});n.items.push(i)});$.each(o,function(t,i){var r=!0;(i.IsDisabled!=undefined&&(r=i.IsDisabled(f)),r!=!0)&&n.items.unshift(i)});f.$CanUpdateReference===!0&&n.items.push({text:"Update Reference",icon:"mdi mdi-filter-remove",onItemClick:function(){f.JsPopUpView.UpdateObjectReference({SQL:f.LvModel.DataSource,ID_CurrentObject:n.row.data.ID,Name:n.row.data.Name,ID_Model:f.ID_Model,SQLUpdateProc:f.LvModel.SQLUpdateProc})}})}n.items.push({text:"Refresh",icon:"fa fa-refresh",onItemClick:function(){f.Grid.refresh()}});n.items.push({text:"Export to xls",icon:"fa fa-file-excel-o",onItemClick:function(){e=!0;f.Grid.exportToExcel(!1)}})},onRowPrepared:function(n){if(f.onRowPrepared!==undefined)f.onRowPrepared(n)},onCellPrepared:function(n){n.column.command!=="expand"&&n.rowType==="filter"&&n.column.SQL!==undefined&&n.cellElement.html($("<div/>").dxListViewBox({SQL:n.column.SQL,placeholder:n.column.placeholder!==undefined?n.column.placeholder:"Find "+n.column.caption+"...",IsMultiSelect:!0,ModelOption:n.column.ModelOption,onInitialized:function(n){f.Grid.FilterListControl.push(n.component)},OnItemSelected:function(t){f.Grid.FilterListData===undefined&&(f.Grid.FilterListData={});var i=n.column.refDataField!==undefined?n.column.refDataField:n.column.dataField;if(t!=null&&t.length>0){f.Grid.FilterListData[i]=Enumerable.From(t).Select("$.ID").ToArray();f.$timeout(function(){f.Grid.refresh()},100);return}f.Grid.FilterListData[i]=null;f.IsGridRefresh!==!1&&f.$timeout(function(){f.Grid.refresh()},100)}}))}},t.FilterMenuItems=[],f.AddActionFilter=function(n){n.isActionFilter=!0;f.$scope.FilterMenuItems.push(n)},f.AddDateFilter=function(n){n.isActionDateRange=!0;f.$scope.FilterMenuItems.push(n)},f.$isAllowEdit==1&&f.$isAllowDelete==1&&(h={ID:2,text:"Delete",icon:"mdi mdi-close",onItemClick:function(){f.PerformDelete()}},f.$scope.ContextMenuItems.push(h)),f.$scope.ContextMenuItems.push({ID:3,color:"#588c73",text:"Refresh",icon:"mdi mdi-refresh"}),f.ActionFilters={},f.$scope.FilterContextMenuOption={bindingOptions:{dataSource:"FilterMenuItems"},itemTemplate:function(n,t,i){var u,e,r;return n.isActionFilter===!0?($(i).parent().parent().css("float","right"),$(i).parent().parent().addClass("jsContextMenuRight"),r=$('<div class="action-filter-container"><div class="action-filter-caption"><span class="mdi mdi-filter"><\/span> '+(n.caption===undefined?"":n.caption)+"<\/div><\/div>"),f.ActionFilters===undefined&&(f.ActionFilters={}),f.ActionFilters[n.name]===undefined&&n.value!==undefined&&(f.ActionFilters==undefined&&(f.ActionFilters={}),f.ActionFilters[n.name]=n.value),u=null,n.searchEnabled=!0,n.SQL!==undefined?(u=new DevExpress.data.DataSource({load:function(t){var r=t.skip==undefined?0:t.skip,u=t.searchValue,s=t.searchExpr!=null?typeof t.searchExpr=="string"?t.searchExpr:t.searchExpr.join():null,e=f.$q.defer(),o=null,i;return n.params!==undefined&&n.params!==null&&(o=$.isFunction(n.params)?n.params():n.params),i=null,$.isFunction(n.SQL)?(i=n.SQL(),console.log(i)):i=n.SQL,f.JSDataService.Query(i,{FilterExpr:u==null?undefined:"Name LIKE '%"+u+"%'",params:o},r).then(function(t){t.collection==null&&(t.collection=[]);r===0&&n.defaultItems!==undefined&&n.defaultItems!==null&&$.each(n.defaultItems,function(n,i){t.collection.unshift(i)});e.resolve(t.collection)}),e.promise},byKey:function(t){var i=null,r;return(n.defaultItems!==undefined&&(i=Enumerable.From(n.defaultItems).Where("$.ID == "+t).ToArray()[0]),i!==null)?i:(r=f.$q.defer(),f.JSDataService.Query(n.SQL,{FilterExpr:"ID = "+t}).then(function(n){if(n.collection.length==0){t.resolve(null);return}r.resolve(n.collection[0])}),r.promise)}}),n.valueExpr="ID",n.displayExpr="Name",n.searchEnabled=!0):u=n.dataSource,e=function(){u.load({searchOperation:"contains",searchValue:null,skip:0,take:20})},$('<div class="action-filter-box"><\/div>').cmSelectBox({dataSource:u,reload:e,placeholder:n.placeholder,searchEnabled:!0,valueExpr:n.valueExpr==undefined?"id":n.valueExpr,displayExpr:n.displayExpr==undefined?"name":n.displayExpr,width:n.width===undefined?"100px":n.width,value:f.ActionFilters[n.name]===undefined?n.value:f.ActionFilters[n.name],onInitialized:function(t){f[n.name]=t.component},onValueChanged:function(t){f.ActionFilters==undefined&&(f.ActionFilters={});f.ActionFilters[n.name]=t.value;f.OnFilterValueChanged(n.name,t);f.Grid.refresh()}}).appendTo(r),r):n.isActionDateRange===!0?(r=$('<div class="action-filter-container"><div class="action-filter-caption"><span class="mdi mdi-calendar"><\/span> '+(n.caption===undefined?"":n.caption)+"<\/div><\/div>"),$("<div><\/div>").jDxDateRangeBox({}).appendTo(r),r):void 0}},f.$scope.GridContextMenuOption={bindingOptions:{dataSource:"ContextMenuItems"},itemTemplate:function(n,t,i){return(n.align==="right"&&($(i).parent().parent().css("float","right"),$(i).parent().parent().addClass("jsContextMenuRight")),n.color===undefined&&n.color==null&&(n.color="#767676"),n.icon===undefined&&n.icon==null&&(n.icon="mdi mdi-file-outline"),n.text===undefined)?"<div class='JsContextMenu'><div class='icon-container' style='background:"+n.color+"'><span class='"+n.icon+"'><\/span><\/div><\/div>":"<div class='JsContextMenu' style='display:table-cell;vertical-align:middle;background:transparent'><div class='item-content'><span style='color:"+n.color+"' class='"+n.icon+"'><\/span> <div class='item-caption'>"+n.text+"<\/div>"+(n.items!==undefined&&n.items!==null?'<span class="fa fa-caret-down"><\/span>':"")+"<\/div>"},displayExpr:"text",onInitialized:function(n){$.each(n.component._options.items,function(n,t){t.disabled===undefined&&(t.disabled=!1)});f.MainToolbar=n.component},onItemClick:function(n){if(n.itemData.onItemClick!==undefined){var t=Enumerable.From(f.Grid.getSelectedRowsData()).ToArray();n.itemData.onItemClick(t);return}switch(n.itemData.ID){case 1:case 2:case 3:case 4:case 5:f.OnToolbarButtonClick(n.itemData.ID);break;case-1002:f.EditListViewControl(f.LvModel.ID_ModelObject);break;case-1003:f.EditModelObject(f.LvModel.ID_Model);break;default:f.OnToolbarButtonClick(n.itemData.ID)}if(f.onMenuItemClick!==undefined)f.onMenuItemClick(n)}},f.GetSelectedRows=function(){return f.Grid.getSelectedRowsData()},f.RefreshToolbar=function(){var n=f.MainToolbar.option("dataSource");$.each(n,function(n,t){if(t.isActionFilter!==!0){if(t.requireMultipleObject!=undefined&&t.requireMultipleObject===!0){if(f.Grid.getSelectedRowsData().length==0){t.disabled=!0;return}t.disabled=!1}t.IsDisabled!==undefined&&(t.disabled=t.requireMultipleObject===!0?f.Grid.getSelectedRowsData().length==0?!0:t.IsDisabled(f.Grid.getSelectedRowsData()):t.IsDisabled(f.Grid.getSelectedRowsData()))}});f.MainToolbar.repaint()},f.OnToolbarButtonClick=function(n){switch(n){case 1:f._OpenDetailView(-1);break;case 2:f.PerformDelete();break;case 3:f.Grid.refresh();break;case 4:e=!0;f.Grid.exportToExcel(!1)}},f.PerformDelete=function(){var n=f.Grid.getSelectedRowsData();n.length!==0&&f.DeleteModelObjects(n).then(function(){f.Grid.refresh()})},f.AddToolbarButton=function(n){if(n.isContextMenuOnly===!0){o.push(n);return}f.$scope.ContextMenuItems.push(n)},f.AddButtonReport=function(n,t){var i;if(t===!0){i=Enumerable.From(o).Where("$.ID == -10099").SingleOrDefault();(i==undefined||i==null)&&(i={ID:-10099,text:"Report",icon:"mdi mdi-note-outline",color:"#767676",disabled:!1,items:[]},o.push(i));i.items.push({text:n.Name,reportData:n,icon:"mdi mdi-note-outline",IsDisabled:n.IsDisabled,onItemClick:function(){var i=f.Grid.getSelectedRowsData(),r,t;i.length!=0&&(r=this.reportData,t=i[0],n.isValid===undefined||n.isValid(t)!==!1)&&f.ViewReport(t.ID,r.ID_Report,t.Name,{ID:t.ID})}});return}i=Enumerable.From(f.$scope.ContextMenuItems).Where("$.ID == -10099").SingleOrDefault();(i==undefined||i==null)&&(i={ID:-10099,text:"Reports",icon:"mdi mdi-note-outline",color:"#3c763d",disabled:!1,isContextMenu:!0,items:[]},f.$scope.ContextMenuItems.push(i));i.items.push({text:n.Name,reportData:n,icon:"jspp-icon js-file-2",onItemClick:function(){var t=this.reportData,i=f.Grid.getSelectedRowsData(),r;if(t.requireSingleObject==undefined&&(t.requireSingleObject=!1),t.requireSingleObject===!0){if(i.length==0){f.MsgBox("Nothing selected");return}if((n.IsMultiSelect==undefined||n.IsMultiSelect==null)&&i.length>1)return}r=i[0];f.ViewReport(r.ID,t.ID_Report,r.Name,{ID:n.IsMultiSelect===undefined?r.ID:Enumerable.From(i).Select("$.ID").ToArray()})}})},f.EditDetailViewControl=function(n){this.JsPopUpView.OpenDetailView(13,{ID_CurrentObject:n,fullScreen:!0})},f.EditListViewControl=function(n){this.JsPopUpView.OpenDetailView(14,{ID_CurrentObject:n,fullScreen:!0})},f.EditModelObject=function(n){this.JsPopUpView.OpenDetailView(4,{ID_CurrentObject:n,fullScreen:!0})},c=function(){var n=1e3;return Math.floor(Math.random()*(1e6-n))+n},f._OpenDetailView=function(n,t){var i=this.LvModel,u=n===-1?-1*c():i.ID_ModelDetailView*1e3*n,e=angular.element(document.body),o=e.injector().get("$rootScope"),r={ID:u,Caption:i.DisplayName,ID_ViewType:2,ViewID:i.ID_ModelDetailView,ID_CurrentObject:n,ImageName:i.Icon,ListViewTab:{ID_View:i.ID_ModelObject,ID_Tab:i.ID_Tab},$onCurrentObjectSaved:function(){f.$scope.$Tab.$dirty=!0}};f.OnOpenDetailView!==undefined&&f.OnOpenDetailView(r,t);f.ModelHelper!=undefined&&f.ModelHelper!==null&&f.ModelHelper.OnOpenDetailView!==undefined&&f.ModelHelper.OnOpenDetailView(r,t);f.ViewHelper!==undefined&&f.ViewHelper!==null&&f.ViewHelper.OnOpenDetailView!==undefined&&f.ViewHelper.OnOpenDetailView(r,t);o.$emit("CallNewTabMethod",r)},f.$scope.ModalMode!=null&&(l=f.$scope.ModalMode,l.SingleSelect===!0?(f.$scope.dataGridOptions.selection.mode="single",f.$scope.dataGridOptions.selection.showCheckBoxesMode="onLongTap",f.$scope.dataGridOptions.onRowClick=function(n){var t=n.data;n.isSelected&&f.$scope.OnLookUpListViewItemSelected!=undefined&&f.$timeout(function(){f.$scope.OnLookUpListViewItemSelected(n.data)})}):(f.$scope.dataGridOptions.selection.showCheckBoxesMode="always",f.$scope.dataGridOptions.onKeyDown=function(n){if(n.jQueryEvent.keyCode===13&&f.$scope.OnLookUpListViewItemSelected!=undefined){var t=n.component.getSelectedRowsData();if(t.length==0)return;f.$timeout(function(){f.$scope.OnLookUpListViewItemSelected(t)})}})),t.ClearFilter=function(){f.dxSearchBox.option("value","");f.IsGridRefresh=!1;f.Grid.FilterListControl!==undefined&&f.Grid.FilterListControl!==null&&$.each(f.Grid.FilterListControl,function(n,t){t.Clear()});f.Grid.clearFilter();f.IsGridRefresh=!0;f.Grid.refresh()},f.ModelHelper!=null){f.ModelHelper.Init(this);f.ModelHelper.onInitListView(this)}if(f.ViewHelper!=null){f.ViewHelper.Init(this);f.ViewHelper.onInitListView(this)}},t.prototype.onCustomizeColumns=function(){},t.prototype.onContextMenuPreparing=function(){},t.prototype.OnFilterValueChanged=function(){},t.prototype.OpenDetailView=function(n){var t=n.data;_._OpenDetailView(t.ID,t)},t});