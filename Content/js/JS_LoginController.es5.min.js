"use strict";app.controller("LoginController",["$scope","$http","$location","JsPopUpView","JSDataService","JsWizardView","CacheFactory",function(n,t,i,r,u,f,e){var h=e("$JSLoginCache",{cacheFlushInterval:36e5,deleteOnExpire:"aggressive",storageMode:"localStorage"}),c=h.get("/LastUserLogin"),o,s;n.LoginModel={Username:c!==undefined?c.Username:null,Password:null,ID_Company:-1};o=null;s=function(){var u=o.validate(),i;u.isValid!==!1&&(i={method:"POST",url:"/Login/SignIn",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(n){var t=[];for(var i in n)t.push(encodeURIComponent(i)+"="+encodeURIComponent(n[i]));return t.join("&")},data:n.LoginModel},t(i).then(function(t){var i=JSON.parse(t.data);if(i.Status==-1){r.MsgBox(i.Message,"Login");return}if(i.IsChangePasswordUponFirstLogin===!0){i.HasPassword=!1;f.$changePasswordDialog(i).then(function(){window.location.replace("/Home")});return}h.put("/LastUserLogin",{Username:n.LoginModel.Username});window.location.replace("/Home")},function(){}))};n.buttonLogin={text:"Login",onClick:s};n.Companies=[{ID:-1,Name:"All Companies"}];n.FormOptions={bindingOptions:{"formData.Username":"LoginModel.Username","formData.Password":"LoginModel.Password"},formData:n.LoginModel,showColonAfterLabel:!1,onEditorEnterKey:function(){s()},onInitialized:function(n){o=n.component},items:[{dataField:"Username",validationRules:[{type:"required",message:"Username is required"}],label:{visible:!1},editorOptions:{placeholder:"Username",showClearButton:!0,onValueChanged:function(){}}},{dataField:"Password",label:{visible:!1},editorOptions:{mode:"password",placeholder:"Password",showClearButton:!0,onValueChanged:function(){}}}]}}]);